package com.pedrotavares.paidmedia.utils.loopingGallery{	// GREENSOCK IMPORTS	import com.greensock.*;	import com.greensock.easing.*;	import com.greensock.plugins.*;	// CUSTOM IMPORTS	import com.pedrotavares.paidmedia.utils.loopingGallery.events.LoopingGalleryEvent;	// FLASH IMPORTS	import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.geom.*;	public class GallerySetup extends MovieClip	{		private var galleryItems	:MovieClip;		private var galleryChild	:MovieClip;		private var totalItems		:Array;		private var indexArr		:Array;		private var moveLeft_mc		:MovieClip;		private var moveRight_mc	:MovieClip;		private var spread			:int;		private var itemsShown		:int;		public function GallerySetup(galleryItems:MovieClip, moveLeft_mc:MovieClip, moveRight_mc:MovieClip, spread:int=100, itemsShown:int=5)		{			// Activate greesock plugins			TweenPlugin.activate([ScalePlugin,AutoAlphaPlugin]);			// Get the gallery mc and assign to the current var;			this.galleryItems = galleryItems;			this.moveLeft_mc = moveLeft_mc;			this.moveRight_mc = moveRight_mc;			// Get the amount to spread the mcs by and assign to its var			this.spread = spread;			// Get the total number of items to show			this.itemsShown = itemsShown;			// Wait until this is palced on the stage			this.addEventListener(Event.ADDED_TO_STAGE, handleAddedToStage);			//trace("Gallery Setup");		}		private function handleAddedToStage(event:Event):void		{			// Stop listening to the ADDED_TO_STAGE			this.removeEventListener(Event.ADDED_TO_STAGE, handleAddedToStage);			// Create a new array to hold all children			totalItems = new Array();			// Create a new array to hold the index of each child			indexArr = new Array();			// Loop thru the gallery mc and check how many children are there			for (var i:int=0; i < galleryItems.numChildren; i++)			{				// Assign each child to a mc				galleryChild = galleryItems.getChildAt(i) as MovieClip;				// Push the child into an array				totalItems.push(galleryChild);				// Push the index number into the array				indexArr.push(i);			}			//trace("Added to the stage");						// Add some event listeners			moveLeft_mc.addEventListener(MouseEvent.CLICK, moveLeft);			moveRight_mc.addEventListener(MouseEvent.CLICK, moveRight);			moveLeft_mc.buttonMode = moveRight_mc.buttonMode = true;						galleryItems.addEventListener(MouseEvent.CLICK, onGalleryClick);			galleryItems.buttonMode = true;						// Check to see how many items to show			checkItems();		}				private function checkItems():void		{			//trace("[LOOPING GALLERY] " + itemsShown);			switch (itemsShown)			{				case 3:					updatePositionsItems3();				break;								default:					updatePositions();				break;			}		}		private function updatePositions()		{			for(var i:int = 0; i < totalItems.length; i++)			{				var posX;				var posY;				var thisScale;				var thisVisibility;												switch (indexArr[i]) 				{						case 0:							posX = -spread*1.8;							thisScale = .6;							thisVisibility = 1						break;												case 1:							posX = -spread;							thisScale = .8;							thisVisibility = 1						break;												case 2:							posX = 0;							thisScale = 1;							thisVisibility = 1							// This is the foremost item							galleryItems.setChildIndex(totalItems[i], galleryItems.numChildren - 1);						break;												case 3:							posX = +spread;							thisScale = .8;							thisVisibility = 1						break;												case 4:							posX = +spread*1.8;							thisScale = .6;							thisVisibility = 1							// This is quite far back							galleryItems.setChildIndex(totalItems[i], 1);						break;												default:							posX = 0;							posY = 0;							thisScale = .5;							thisVisibility = .9							// Send it to the back of the pile							galleryItems.setChildIndex(totalItems[i], 0);						break;				}				TweenMax.to(totalItems[i], .3, {x:posX, scale:thisScale, autoAlpha:thisVisibility} );			}		}				private function updatePositionsItems3()		{			for(var i:int = 0; i < totalItems.length; i++)			{				var posX;				var posY;				var thisScale;				var thisVisibility;												switch (indexArr[i]) 				{						case 0:							posX = -spread;							thisScale = .8;							thisVisibility = 1						break;												case 1:							posX = 0;							thisScale = 1;							thisVisibility = 1							// This is the foremost item							galleryItems.setChildIndex(totalItems[i], galleryItems.numChildren - 1);						break;												case 2:							posX = +spread;							thisScale = .8;							thisVisibility = 1						break;												default:							posX = 0;							posY = 0;							thisScale = .5;							thisVisibility = .9							// Send it to the back of the pile							galleryItems.setChildIndex(totalItems[i], 0);						break;				}				TweenMax.to(totalItems[i], .3, {x:posX, scale:thisScale, autoAlpha:thisVisibility} );			}		}				private function moveRight(e:MouseEvent):void		{			for(var i:int = 0; i < totalItems.length; i++)			{				indexArr[i]++;				if(indexArr[i] == totalItems.length)				{					indexArr[i] = 0;				}			}			// Check to see how many items to show			checkItems();			// Dispacht a message informing which button has been clicked			dispatchEvent( new LoopingGalleryEvent( LoopingGalleryEvent.MOUSE_CLICK, e.target.name ) );		}				private function moveLeft(e:MouseEvent):void		{			for(var i:int = 0; i < totalItems.length; i++)			{				indexArr[i]--;				if(indexArr[i] < 0)				{					indexArr[i] = totalItems.length -1;				}			}			// Check to see how many items to show			checkItems();			// Dispacht a message informing which button has been clicked			dispatchEvent( new LoopingGalleryEvent( LoopingGalleryEvent.MOUSE_CLICK, e.target.name ) );		}				private function onGalleryClick(e:MouseEvent):void		{			// Dispacht a message informing which button has been clicked			dispatchEvent( new LoopingGalleryEvent( LoopingGalleryEvent.MOUSE_CLICK, e.target.name ) );		}	}}